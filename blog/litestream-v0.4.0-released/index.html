<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <link rel="stylesheet" href="/main.1cf992edc1f37b95c4ddf85b36862f715228199a718763a6aa21f686499e342a4f93190577c6c39e89fd604dfc6a4bfab3e42be269bf084761ad9009e06b5457.css" integrity="sha512-HPmS7cHze5XE3fhbNoYvcVIoGZpxh2OmqiH2hkmeNCpPkxkFd8bDnon9YE38akv6s&#43;Qr4mm/CEdhrZAJ4GtUVw==" crossorigin="anonymous">
<noscript><style>img.lazyload { display: none; }</style></noscript>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;1,400;1,600&display=swap" rel="stylesheet">

  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <title>Litestream v0.4.0 Released - Litestream</title>
<meta name="description" content="The newest version of Litestream includes support for live read replication, improved test coverage, revamped WAL storage, and more.">
<link rel="canonical" href="https://tip.litestream.io/blog/litestream-v0.4.0-released/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://litestream.io/images/twitter-image.png">
<meta name="twitter:title" content="Litestream v0.4.0 Released">
<meta name="twitter:description" content="The newest version of Litestream includes support for live read replication, improved test coverage, revamped WAL storage, and more.">
<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<meta name="twitter:site" content="@litestreamio">
<meta name="twitter:creator" content="@benbjohnson">

<script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https:\/\/tip.litestream.io\/blog\/litestream-v0.4.0-released\/"
      },
      "headline": "Litestream v0.4.0 Released",
      "image": [],
      "datePublished": "2022-04-19T00:00:00CET",
      "dateModified": "2022-04-19T00:00:00CET",
      "author": {
        "@type": "Organization",
        "name": "Litestream"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Litestream",
        "logo": {
          "@type": "ImageObject",
          "url": "https:\/\/tip.litestream.io\/litestream.png"
        }
        },
      "description": "The newest version of Litestream includes support for live read replication, improved test coverage, revamped WAL storage, and more."
    }
    </script>
  <script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position":  1 ,
        "name": "Home",
        "item": "https:\/\/tip.litestream.io\/"
    },{
        "@type": "ListItem",
        "position":  2 ,
        "name": "Blog",
        "item": "https:\/\/tip.litestream.io\/blog\/"
    },{
        "@type": "ListItem",
        "position":  3 ,
        "name": "Litestream V0.4.0 Released",
        "item": "https:\/\/tip.litestream.io\/blog\/litestream-v0.4.0-released\/"
    }]
}
</script>

  <meta name="theme-color" content="#fff">
<link rel="apple-touch-icon" sizes="180x180" href="https://tip.litestream.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://tip.litestream.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://tip.litestream.io/favicon-16x16.png">
<link rel="manifest" href="https://tip.litestream.io/site.webmanifest">
  
</head>
  <body class="blog single">
    <header class="navbar fixed-top navbar-expand-md navbar-light">
  <div class="container align-items-baseline">
    <input class="menu-btn order-0" type="checkbox" id="menu-btn">

    <label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>

    <a class="navbar-brand order-1 order-md-0 mr-auto" href="https://tip.litestream.io/">
      Litestream
    </a>

    <ul class="navbar-nav social-nav order-3 order-md-5">
      <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/litestreamio"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg><span class="ml-2 sr-only">Twitter</span></a>
        </li>
      <li class="nav-item">
          <a class="nav-link" href="https://github.com/benbjohnson/litestream"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ml-2 sr-only">GitHub</span></a>
        </li>
      </ul>

    <div class="collapse navbar-collapse order-4 order-md-1">
      <ul class="navbar-nav main-nav mr-auto order-5 order-md-2"><li class="nav-item">
            <a class="nav-link" href="https://tip.litestream.io/install">Install</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://tip.litestream.io/guides">Guides</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://tip.litestream.io/reference">Reference</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://tip.litestream.io/blog/">Blog</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://github.com/benbjohnson/litestream">GitHub</a>
          </li>
        <li class="nav-item">
            <a class="nav-link" href="https://join.slack.com/t/litestream/shared_invite/zt-n0j4s3ci-lx1JziR3bV6L2NMF723H3Q">Slack</a>
          </li>
        </ul>
      <div class="break order-6 d-md-none"></div>
    </div>
  </div>
</header>
    <div class="wrap container" role="document">
      <div class="content">
        
<div class="row justify-content-center">
	<div class="col-md-12 col-lg-10 col-xl-8">
		<article>
			<div class="blog-header">
				<h1>Litestream v0.4.0 Released</h1>
				<p>
	<small>
		Posted April 19, 2022
		by <a class="stretched-link position-relative" href="https://twitter.com/benbjohnson" target="_blank">Ben Johnson</a>
		&nbsp;&hyphen;&nbsp;
		<strong>5&nbsp;min read</strong>
	</small>
<p>
			</div>
			<p class="lead"></p>
			<p>The main focus of this latest release has been on implementing live read
replication and underlying changes to support this. We&rsquo;ve also significantly
expanded test coverage as well as added quality-of-life changes.</p>
<h2 id="live-read-replication">Live Read Replication</h2>
<p>By far, the most requested feature in Litestream has been
<a href="https://github.com/benbjohnson/litestream/issues/8">live read replication</a>.
The idea with this feature is that you can have a single primary server that
runs SQLite and it can immediately fan out changes to one or more read-only
replicas. It provides both read scalability as well as the ability to move data
out to the edge and provide low latency responses to anyone in the world.</p>
<p>You can try it out with the <a href="https://litestream-read-replica-demo.fly.dev/">Litestream Read Replica Demo</a>
which has a single primary node in Chicago (<code>ord</code>) that immediately streams
out changes to 15 other regions worldwide.</p>
<p>This feature is still considered &ldquo;beta&rdquo; but if you want to try it out, we have
an <a href="https://github.com/benbjohnson/litestream-read-replica-example">example repository</a>
for deploying a Docker image to <a href="https://fly.io/">fly.io</a>.</p>
<h3 id="file-watchers">File Watchers</h3>
<p>Previously, the WAL file was polled every second by Litestream to detect changes.
This worked fine when changes were replicated to S3 every second, however, we
needed lower latency for live replication. To do this, we&rsquo;ve changed from
polling to using a file watcher. We use <code>inotify</code> for Linux and <code>kqueue</code> for
BSD-based systems.</p>
<p>This change allows us to immediately receive change notifications, however,
we still batch up changes every 10 milliseconds to avoid an explosion of small
WAL segment files on disk. You can adjust this threshold with the
<code>monitor-delay-interval</code> database configuration setting.</p>
<p>In addition to lower latency, this change also makes it more practical to
replicate a larger number of databases at a time.</p>
<h3 id="shadow-wal-changes">Shadow WAL Changes</h3>
<p>The shadow WAL used to store all WAL segments in a single directory which worked
well when we only generated one WAL segment per second. However, the lower
latency file watchers can now generate up to 100 segment files per second so a
single directory was impractical.</p>
<p>The shadow WAL and the replica WAL layout are now grouped in directories by WAL
index. This makes it easier to seek to a given set of WAL files and reduces the
number of files per directory. You will not need to adjust settings when you
upgrade from v0.3.x to v0.4.0, however, you will not be able to restore WAL
files from the old WAL layout when using the new version.</p>
<h2 id="updated-contribution-policy">Updated Contribution Policy</h2>
<p>Litestream originally started off with a strict &ldquo;no contribution&rdquo; policy in
order to limit maintainer burn out. However, that turned out to be a bit excessive
as it caused folks to open issues for simple changes like typos. The
contribution policy has been updated so that minor bug fixes will now be
accepted, however, we&rsquo;re still not accepting code for new features. If you have
an idea for a feature, please open an issue to discuss.</p>
<h2 id="improved-test-coverage--ci">Improved test coverage &amp; CI</h2>
<p>Much of the testing done in v0.3.x was unit testing and some integration tests
for the replica clients. In v0.4.0, we&rsquo;ve added significantly more unit test
coverage and as well as functional testing against the <code>litestream</code> binary itself.</p>
<p>We&rsquo;ve also built out the CI pipeline to not only run these tests but it
also generates release artifacts on every PR. This includes binaries uploaded
as GitHub artifacts as well as Docker images that are tagged with the long SHA,
short SHA, and the PR number. It makes it much easier for folks to test new
features before they get included in an official release.</p>
<h2 id="removing-windows-support">Removing Windows Support</h2>
<p>Windows support was an early request for Litestream and we spent quite a bit of
time implementing it. However, we&rsquo;ve found limited usage of the Windows binaries
and we lack Windows expertise so we are dropping support in v0.4.0.</p>
<p>We may reconsider re-adding Windows support in the future though.</p>
<h2 id="passing-database-path-to-child-process">Passing database path to child process</h2>
<p>Tobi Lütke had <a href="https://twitter.com/tobi/status/1401940776465190915">a great suggestion</a>
of passing through the database path to the child process when using the <code>-exec</code>
flag. Litestream now sets the <code>LITESTREAM_DB_PATH</code> environment variable on the
child process so you don&rsquo;t need to duplicate your database path to both
Litestream and your application. You can see more details on <a href="https://github.com/benbjohnson/litestream/issues/216">issue #216</a>.</p>
<h2 id="updating-google-cloud-storage-prefix">Updating Google Cloud Storage Prefix</h2>
<p><a href="https://github.com/febkor">fekbor</a> made a good point that Google Cloud Storage uses <code>&quot;gs&quot;</code> as their URL
scheme instead of <code>&quot;gcs&quot;</code> so we&rsquo;ve changed all reference to use &ldquo;gs&rdquo;. You can
find more details on <a href="https://github.com/benbjohnson/litestream/issues/336">issue #336</a>.</p>
<h2 id="miscellaneous-fixes">Miscellaneous fixes</h2>
<p>Several quality of life fixes and bugs were resolved:</p>
<ul>
<li>The <code>replicate</code> command can now enable the web server with the <code>-addr</code> flag (<a href="https://github.com/benbjohnson/litestream/issues/243">#243</a>)</li>
<li>The <code>litestream.yml</code> config file will be read from the present working directory (<a href="https://github.com/benbjohnson/litestream/issues/282">#282</a>)</li>
<li>Updated SQLite driver to use <code>SQLITE_FCNTL_PERSIST_WAL</code> to persist WAL after close (<a href="https://github.com/benbjohnson/litestream/pull/287">#287</a>)</li>
<li>Fix WAL overrun validation bug (<a href="https://github.com/benbjohnson/litestream/pull/303">#303</a>)</li>
<li>Prevent double-close for SFTP client (<a href="https://github.com/benbjohnson/litestream/issues/268">#268</a>)</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>We think there&rsquo;s a lot of potential for improving application latency by using
the live read replicas in v0.4.0. We&rsquo;re also working on some new designs for
SQLite replication that we hope to write about in the coming months. If you&rsquo;re
interested in hearing more, please <a href="https://join.slack.com/t/litestream/shared_invite/zt-n0j4s3ci-lx1JziR3bV6L2NMF723H3Q">join our Slack</a> or <a href="https://twitter.com/litestreamio">follow Litestream
on Twitter</a> for updates.</p>

		</article>
	</div>
</div>

      </div>
    </div>
    
    
    <footer>
</footer>
    
    <script src="https://tip.litestream.io/main.f6b484f556ad1f3bcf6061082139a2f21fa759f13930c39a25fe4a9f78f35e64122c2d86dffd56e67b292dabbda4095d8077194f196e0e348441c106a9f3d40e.js" integrity="sha512-9rSE9VatHzvPYGEIITmi8h&#43;nWfE5MMOaJf5Kn3jzXmQSLC2G3/1W5nspLau9pAldgHcZTxluDjSEQcEGqfPUDg==" crossorigin="anonymous" defer></script>
  <script src="https://tip.litestream.io/index.min.c4081fc2b1ad0665da0220ee4df16de951a58208e19e53688ecdb4c9de9f25493b49061d4c9ccea9eb37a4a2b8806e52c77b6f96526490ef6eaa4cbf36e9e5df.js" integrity="sha512-xAgfwrGtBmXaAiDuTfFt6VGlggjhnlNojs20yd6fJUk7SQYdTJzOqes3pKK4gG5Sx3tvllJkkO9uqky/Nunl3w==" crossorigin="anonymous" defer></script>

  </body>
</html>